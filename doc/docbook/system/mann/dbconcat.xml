<refentry xmlns="http://docbook.org/ns/docbook" version="5.0" xml:id="dbconcat">

  <refmeta>
    <refentrytitle>DBCONCAT</refentrytitle>
    <manvolnum>nged</manvolnum>
    <refmiscinfo class="source">BRL-CAD</refmiscinfo>
    <refmiscinfo class="manual">BRL-CAD User Commands</refmiscinfo>
  </refmeta>

  <refnamediv xml:id="name">
    <refname>dbconcat</refname>
    <refpurpose>
      Concatenates an existing BRL-CAD database to the
      database currently being edited.
    </refpurpose>
  </refnamediv>

  <!-- body begins here -->
  <refsynopsisdiv xml:id="synopsis">
    <cmdsynopsis sepchar=" ">
      <command>dbconcat</command>
      <arg choice="opt" rep="norepeat"><replaceable>-t</replaceable></arg>
      <arg choice="opt" rep="norepeat"><replaceable>-u</replaceable></arg>
      <arg choice="opt" rep="norepeat"><replaceable>-c</replaceable></arg>
      <arg choice="opt" rep="norepeat"><replaceable>-s|-p</replaceable></arg>
      <arg choice="opt" rep="norepeat"><replaceable>-O</replaceable></arg>
      <arg choice="req" rep="norepeat"><replaceable>database_file</replaceable></arg>
      <arg choice="opt" rep="norepeat"><replaceable>affix</replaceable></arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsection xml:id="description"><title>DESCRIPTION</title>

    <para>
      Concatenates an existing <emphasis>BRL-CAD</emphasis> database to the
      database currently being edited. Note that each <emphasis>BRL-CAD</emphasis>
      object must have a unique name, so care must be taken when using "dbconcat" to
      import a database that has objects with names the same as objects in the current
      database.
    </para>
    <para>
      If confliting names are encountered, computer-generated prefixes will be added
      to the object names coming from the incoming <emphasis>database_file</emphasis>.
      HOWEVER, by default  member names appearing in combinations will NOT be modified
      to reference the new names - this means that the imported combs will point to the
      objects in the current database, NOT the copies brought in by dbconcat.  This is
      dangerous and should be avoided unless the user knows exactly what they are doing.
    </para>
    <para>
      One approach to resolving conflicting names is to simply overwrite the current objects.
      If the <emphasis>-O</emphasis> option is supplied, all conlicts will automatically be resolved
      by overwritting the original object with its replacment from <emphasis>database_file</emphasis>.
      Note that using this option is destructive - old geometry is not preserved when being overwritten.
      Consequently this should only be used when the intent is to NOT preserve the original data.
    </para>
    <para>
      Aternately, if an <emphasis>affix</emphasis> string is supplied, then all objects from
      the incoming <emphasis>database_file</emphasis> will have the <emphasis>affix</emphasis> added
      to their names as a prefix (by default or if the <emphasis>-p</emphasis> option is specified),
      or as a suffix (if the <emphasis>-s</emphasis> option is specified).  In either mode the
      <emphasis>affix</emphasis> string is added to ALL incoming object names, not just those cases
      where there is a conflict.  However, comb trees on incoming geometry are also updated to
      reference the names using the <emphasis>affix</emphasis> string, so this offers a way to
      bring hierarchies in correctly.
    </para>
    <para>
      Note that specifying such an <emphasis>affix</emphasis> string is not a guarantee of
      avoiding conflicts.  The <command>dup</command> command should be used to check for
      duplicate names. If the <command>dup</command> command still finds duplicate
      names, use the <emphasis>prefix</emphasis> option to both the <command>dup</command> and
      <command>dbconcat</command> commands to find a <emphasis>prefix</emphasis> that produces
      no duplicates.
    </para>


    <para>
      Other options are used to indicate whether or not to preserve incoming metadata such as title, units
      and region color table.
    </para>
  </refsection>

  <refsection xml:id="dbconcat_options"><title>OPTIONS</title>

    <variablelist remap="TP">
      <varlistentry>
	<term><emphasis remap="B" role="bold">-O</emphasis></term>
	<listitem>
	  <para>
	    Overwrite objects in the current .g file in cases where incoming
	    object names conflict. (WARNING: this option is destructive - old
	    data is replaced by new.)
	  </para>
	</listitem>
      </varlistentry>
      <varlistentry>
	<term><emphasis remap="B" role="bold">-c</emphasis></term>
	<listitem>
	  <para>
	     Indicates that the region color table of the currently edited database
             should be replaced with that of <emphasis>database_file</emphasis>.
	  </para>
	</listitem>
      </varlistentry>
      <varlistentry>
	<term><emphasis remap="B" role="bold">-p</emphasis></term>
	<listitem>
	  <para>
	    Use the supplied <emphasis>affix</emphasis> string as a prefix when reading in object names. (Default.)
	  </para>
	</listitem>
      </varlistentry>
      <varlistentry>
	<term><emphasis remap="B" role="bold">-s</emphasis></term>
	<listitem>
	  <para>
	    Use the supplied <emphasis>affix</emphasis> string as a suffix when reading in object names.
	  </para>
	</listitem>
      </varlistentry>
      <varlistentry>
	<term><emphasis remap="B" role="bold">-t</emphasis></term>
	<listitem>
	  <para>
	     Indicates that the title of the currently edited database
             should be replaced with that of <emphasis>database_file</emphasis>.
	  </para>
	</listitem>
      </varlistentry>
      <varlistentry>
	<term><emphasis remap="B" role="bold">-u</emphasis></term>
	<listitem>
          <para>
	    Indicates that the units of the incoming <emphasis>database_file</emphasis> 
	    should become the units of the currently edited database.
	  </para>
	</listitem>
      </varlistentry>
    </variablelist>

  </refsection>



  <refsection xml:id="examples"><title>EXAMPLES</title>

    <para>
      This example shows the use of the <command>dbconcat</command> command to copy all objects in a particular
      database to the current database. It also shows how to add a particular prefix to every object copied.
    </para>
    <example><title>Copy objects in a specified database to the current one and add a prefix to all the copied objects.</title>

      <para><prompt>mged&gt; </prompt><userinput>dbconcat model_two.g two_</userinput></para>
      <para>
	Copies all the objects in <emphasis>model_two.g</emphasis> to the current database,
	but prefixes the name of every object copied with the string <emphasis>two_</emphasis>.
      </para>
    </example>

    <para>
      Another example shows a usage to import the title, units, color table, and all the objects of a database file
      into the current database. This is particularly useful if the current database is empty or just created by mged.
    </para>
    <example><title>Copy an entire database, including title, units, and color table, to the current database without any affix</title>

      <para><prompt>mged&gt; </prompt><userinput>dbconcat -t -u -c model_two.g</userinput></para>
      <para>
	Copies all the objects in <emphasis>model_two.g</emphasis> to the current database, including the title, units,
	and color table. No suffix or prefix is added to the object names.
      </para>
    </example>

    <example><title>Copy a database, overwriting objects in the current databse</title>

      <para><prompt>mged&gt; </prompt><userinput>dbconcat -O model_two.g</userinput></para>
      <para>
	Copies all the objects in <emphasis>model_two.g</emphasis> to the current database. No object names are changed while
	conflicts in the current database are overwritten with objects from <emphasis>model_two.g</emphasis>
      </para>
    </example>

  </refsection>

  <refsection xml:id="author"><title>AUTHOR</title><para>BRL-CAD Team</para></refsection>

  <refsection xml:id="bug_reports"><title>BUG REPORTS</title>

    <para>
      Reports of bugs or problems should be submitted via electronic
      mail to <email>devs@brlcad.org</email>
    </para>
  </refsection>
</refentry>
