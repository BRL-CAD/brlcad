/*
 *			C A K E F I L E . L I B
 *
 *  Cakefile for building a single library archive.
 *  Symbol PRODUCTS should be name of a single library
 *
 *  Author -
 *	Michael John Muuss
 *  
 *  Source -
 *	SECAD/VLD Computing Consortium, Bldg 394
 *	The U. S. Army Ballistic Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5066
 *  
 *  Distribution Status -
 *	Public Domain, Distribution Unlimitied.
 *
 *  $Header$
 */

#ifndef PRODUCTS
#	include "Symbol PRODUCTS required to make library"
#endif
#ifndef SRCDIR
#	include "Symbol SRCDIR required"
#endif
#ifndef OBJ
#	include "Symbol OBJ required"
#endif

#ifndef EXTRA_OBJ
#	define	EXTRA_OBJ	/**/
#endif

#ifndef EXTRA_SETUP
#	define	EXTRA_SETUP	/**/
#endif

#ifndef EXTRA_OBJ_NO_DEPENDENCY
#	define EXTRA_OBJ_NO_DEPENDENCY	/**/
#endif

#if !defined(LIBVERS)
PRODUCTS::	EXTRA_OBJ OBJ
	rm -f PRODUCTS; EXTRA_SETUP
	AR r PRODUCTS OBJ EXTRA_OBJ EXTRA_OBJ_NO_DEPENDENCY
	RANLIB PRODUCTS
#else
/* Shared library support.  "EXTRA_SETUP" increments version number. */
/* Can't list SHARED_PRODUCT in 'rm' command, or will get wrong version number.
 * (Cake won't re-run the LIBVERS shell script)
 */
#define	SHARED_PRODUCT	PRODUCTS.LIBVERS
PRODUCTS&::	EXTRA_OBJ OBJ
	rm -f PRODUCTS*; EXTRA_SETUP
	BUILD_LIBRARY SHARED_PRODUCT OBJ EXTRA_OBJ EXTRA_OBJ_NO_DEPENDENCY
#endif

%.o&:	SRCDIR,,%,o			if exist ../SRCDIR/%.c

%9,,%,o&:	../%9/%.c HDR_DEP9	if exist ../%9/%.c
	CC CFLAGS -c ../%9/%.c

/* Override the modes for the library */
#undef	BINDIR
#undef	BINPERM
#define	BINDIR	LIBDIR
#define	BINPERM	LIBPERM

/* If RANLIB is specified, be sure it is run when installing libraries */
#define AFTERINSTALL	RANLIB
